# Implementation Plan: Advanced Solver Modes (Logic v1, v2, v3)

**Branch**: `001-advanced-solvers` | **Date**: 2025-11-06 | **Spec**: specs/001-advanced-solvers/spec.md  
**Input**: Feature specification from `/specs/001-advanced-solvers/spec.md`

**Note**: Generated and completed per speckit.plan workflow.

## Summary

Implement three solver modes to increase Hidato puzzle coverage:
- v1: Two-ended propagation + global uniqueness checks with incremental candidate model and early contradictions. No guessing.
- v2: Region- and shape-aware pruning (island elimination, segment bridging/corridor feasibility, degree pruning), optional edge nudges. No guessing.
- v3: Bounded backtracking with MRV/LCV/frontier-biased ordering, budgets/timeouts, optional transposition table; always run v0–v2 logic to a fixpoint around guesses. Deterministic trace with clear guess/undo markers.

## Technical Context

**Language/Version**: Python 3.11.x  
**Primary Dependencies**: Standard library only (dataclasses optional)  
**Storage**: N/A (in-memory puzzle state)  
**Testing**: pytest; linting with ruff  
**Target Platform**: Local execution on Windows 11/macOS/Linux (reference perf on Windows 11 i7-12700H)  
**Project Type**: Single library/CLI repo (domain modules + REPL)  
**Performance Goals**: v1/v2 solve 15x15 medium in ≤300ms median; v3 within node/time budgets with graceful stop  
**Constraints**: Deterministic outputs, no mutation of caller puzzle, explainable steps, standard library only  
**Scale/Scope**: Board sizes up to ~20x20; node budgets up to 20k (configurable) for v3

## Constitution Check

Gate evaluation (pre-Phase 0):
- Explainability first: All placements record short reason; v3 marks Guess/Backtrack. → PASS
- Hint API: `hint(mode=...)` returns one logical move without mutation. → PASS (to be implemented)
- Monotone logic before search: v3 runs v0–v2 to fixpoint pre/post guesses. → PASS
- Determinism: Stable ordering via `tie_break=row_col`; MRV/LCV ties deterministic. → PASS
- No mutation of caller: Solver deep-copies `Puzzle`; returns `SolverResult`. → PASS
- Cheap checks first: Range/duplicate/adjacency impossibility early. → PASS

Re-check post-Phase 1: PASS (design honors above; see research/data-model).

## Project Structure

### Documentation (this feature)

```text
specs/001-advanced-solvers/
├── plan.md              # This file (completed)
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output (OpenAPI for solver service)
└── tasks.md             # Phase 2 output (to be generated by /speckit.tasks)
```

### Source Code (repository root)

```text
app/
core/
generate/
hidato_io/
solve/
util/
tests/
```

**Structure Decision**: Single-project Python repo with domain-separated modules. New solver modes integrate under `solve/` (e.g., extend `solver.py` and `strategies.py`), preserving public APIs and REPL UX.

## Complexity Tracking

No constitution violations anticipated.
